# **人脸几何特征提取与分析**

## ***精确面部几何测量与可视化***

本项目旨在开发一套基于Python的计算机视觉系统，能够从用户上传的人脸正脸照片中，精确地提取面部几何特征，并进行可视化分析。核心功能包括：人脸检测、关键点定位、智能肤色分割、高精度脸颊轮廓提取、人脸中线拟合，以及计算并绘制面部切线与中线的夹角。

* 接收用户人脸照片  
* 自动分析面部几何特征  
* 可视化关键线条与角度  
* ✨ 智能与精准 ✨

## **核心功能**

本项目利用一系列先进的计算机视觉技术，实现以下核心功能：

* **人脸与关键点检测**  
  * 利用Dlib库进行高效、准确的人脸检测。  
  * 基于Dlib的68点面部关键点模型，精确定位眉毛、眼睛、鼻子、嘴巴和下巴等标志点。  
* **智能肤色分割**  
  * 结合HSV和YCbCr颜色空间进行肤色检测，生成初步的二值掩膜。  
  * 通过形态学操作（腐蚀与膨胀）优化掩膜，有效去除噪声并排除背景干扰（如白色衣物褶皱），确保人脸区域的纯净性。  
* **高精度脸颊轮廓提取**  
  * 基于肤色分割结果，提取人脸最大连通域的轮廓。  
  * 使用cv2.approxPolyDP对提取到的轮廓进行多边形近似，通过精细调整epsilon参数，生成高密度、平滑且精细的脸颊轮廓点。  
* **精确人脸中线拟合**  
  * 通过对眉毛、眼睛、鼻梁、嘴唇和下巴等多个Dlib关键点进行**线性回归拟合**。  
  * **创新点**：为应对人脸偏转导致中线不垂直的情况，采用**X,Y坐标反转**的线性回归方法（拟合 x=m′y+c′），确保拟合出的中线能够更准确地反映人脸的实际倾斜姿态，提高鲁棒性。  
* **面部切线计算与绘制**  
  * 识别嘴角平行线与托盘水平线的交点。  
  * **智能筛选**脸颊轮廓上的候选切点，结合Dlib关键点，精确定义脸颊的垂直区域（上边界和下边界），避免切线误落在下巴或非脸颊区域。  
  * 判断连接交点与候选点的直线是否为轮廓的“支持线”，并选择距离交点最近且符合条件的点作为最佳切点。  
  * 绘制从交点到脸颊的切线。  
* **夹角计算与可视化**  
  * 计算切线方向向量与精确拟合的人脸中线方向向量之间的锐角。  
  * 在图像上可视化角度弧线及数值，提供直观的几何分析结果。  
* **多阶段可视化调试**  
  * 在关键处理步骤中嵌入cv2.imshow()功能，便于开发和调试过程中实时观察中间结果（如原始图片、各阶段肤色掩膜、最终轮廓、中线拟合点等），快速定位和解决问题。

## **技术栈**

本项目使用了以下强大的Python库：

* [**OpenCV**](https://opencv.org/) \- 图像处理、计算机视觉任务的核心库。  
* [**Dlib**](http://dlib.net/) \- 包含机器学习算法，尤其在人脸检测和关键点定位方面表现卓越。  
* [**NumPy**](https://numpy.org/) \- Python科学计算的基础，提供高性能多维数组对象。  
* [**SciPy**](https://scipy.org/) \- 提供科学和技术计算工具，包括线性回归功能。

## **环境依赖与安装**

本项目推荐使用 conda 创建和管理虚拟环境，以确保依赖的兼容性和隔离性。

1. 安装 Anaconda 或 Miniconda  
   如果尚未安装，请从官方网站下载并安装 Anaconda 或 Miniconda。  
2. **创建并激活干净环境**  
   \# 创建 Python 3.9 环境 (推荐版本，可根据需要调整)  
   conda create \-n face39 python=3.9 \-y  
   \# 激活环境（每次使用项目前都需要执行此命令）  
   conda activate face39

3. **一键安装核心库（conda-forge 通道）**  
   conda install \-c conda-forge numpy opencv dlib scipy

4. Dlib 模型文件  
   本项目需要Dlib的预训练模型shape_predictor_68_face_landmarks.dat.bz2。请确保将此文件下载并放置在项目根目录下的model/文件夹中。  
   您可以从以下链接下载该模型：http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2
   下载后请解压得到.dat文件。


## **调试与优化**

本项目在代码中嵌入了多阶段可视化功能，方便您进行调试和参数优化：

* **肤色分割**：如果肤色掩膜不准确（包含背景或缺失人脸部分），请调整代码中lower\_skin, upper\_skin (HSV) 和 lower\_skin\_ycbcr, upper\_skin\_ycbcr (YCbCr) 的阈值。  
* **轮廓平滑度**：如果脸颊轮廓不够平滑或点密度不足，请调整cv2.approxPolyDP中的epsilon参数（减小其乘数）。  
* **中线与切线定位**：如果中线或切线位置不理想，请检查jawline\_bottom\_y和cheek\_upper\_bound\_y的定义（调整向上或向下的像素值），以及切点筛选逻辑。

## **贡献**

欢迎对本项目提出改进意见或提交Pull Request。

